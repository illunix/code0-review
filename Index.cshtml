@model Ravency.Areas.Panel.SubAreas.Catalog.Products.Index.Model
@{
    ViewData["Title"] = "Products";
    Layout = "_LayoutAdmin";
}

@section Styles
{
    <link rel="stylesheet" href="~/lib/toastr.js/toastr.min.css">
    <link rel="stylesheet" href="~/lib/dropzone/basic.min.css" />
    <link rel="stylesheet" href="~/lib/dropzone/dropzone.min.css" />
    <link rel="stylesheet" href="~/lib/select2-bootstrap4-theme/select2-bootstrap.min.css" />
    <style>
        .dropzone {
            border: 1px solid #ced4da;
            border-radius: .25rem;
            background: #fff !important;
        }

            .dropzone .dz-preview.dz-image-preview {
                background: transparent;
                zoom: 0.65;
            }

            .dropzone .dz-details {
                display: none;
            }

            .dropzone .dz-preview .dz-progress {
                display: none;
            }

            .dropzone .dz-preview .dz-remove {
                font-size: 18px
            }

            .dropzone .dz-preview:hover .dz-image img {
                -webkit-transform: scale(1.05, 1.05);
                -moz-transform: scale(1.05, 1.05);
                -ms-transform: scale(1.05, 1.05);
                -o-transform: scale(1.05, 1.05);
                transform: scale(1.05, 1.05);
                -webkit-filter: blur(8px);
                filter: blur(0px);
            }
    </style>
}

<div class="content-header">
    <div class="row mb-2">
        <div class="col-sm-0">
            <h3 class="m-0 font-weight-light">Products</h3>
        </div>
    </div>
</div>
<div class="row">
    <div class="col-12">
        <div class="d-flex flex-row-reverse col-md-12">
            <div class="row mb-2">
                <a data-toggle="modal" data-target="#modal-add" class="btn btn-primary" href="#">Add product</a>
            </div>
        </div>
        <div class="card">
            <div class="card-body">
                <table id="products-table" class="table table-striped table-bordered">
                    <thead>
                        <tr>
                            <th>Name</th>
                            <th>Category</th>
                            <th>Sub category</th>
                            <th>Price</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var product in Model.Products)
                        {
                            <tr>
                                <td>@product.Name</td>
                                <td>@product.SubCategory.Category.Name</td>
                                <td>@product.SubCategory.Name</td>
                                <td>@product.Price</td>

                                <td class="project-actions text-right">
                                    <a class="btn btn-info btn-sm btn-edit" href="#" data-id="@product.Id" data-edit-button data-toggle="modal" data-target="#modal-edit">
                                        <i class="fas fa-pencil-alt" title="Edit">
                                        </i>
                                    </a>
                                    <a class="btn btn-danger btn-sm btn-delete" href="#" data-id="@product.Id" data-delete-button data-toggle="modal" data-target="#modal-confirm-delete">
                                        <i class="fas fa-trash" title="Delete">
                                        </i>
                                    </a>
                                </td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>
<div class="modal fade" id="modal-add">
    <div class="modal-dialog">
        <div class="modal-content active">
            <div class="modal-header">
                <h4 class="modal-title">Add product</h4>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <form asp-action="Add" asp-antiforgery="true">
                <div class="modal-body">
                    <ul class="nav nav-tabs">
                        <li class="active">
                            <a class="nav-item nav-link active" href="#tab-general" data-toggle="tab">General</a>
                        </li>
                        <li>
                            <a class="nav-item nav-link" href="#tab-data" data-toggle="tab">Data</a>
                        </li>
                    </ul>
                    <div class="tab-content">
                        <div class="tab-pane active" id="tab-general">
                            <ul class="nav nav-tabs mt-3" id="language">
                                @foreach (var language in Model.Languages)
                                {
                                    <li class="@(language.IsDefault ? "active" : "")">
                                        <a class="nav-item nav-link @(language.IsDefault ? "active" : "")" href="#@language.Name.ToLower()-language" data-toggle="tab">@language.Name</a>
                                    </li>
                                }
                            </ul>
                            <div class="tab-content p-3">
                                @for (var i = 0; i < Model.Languages.Count; i++)
                                {
                                    <div class="tab-pane @(Model.Languages[i].IsDefault ? "active" : "")" id="@Model.Languages[i].Name.ToLower()-language">
                                        <div class="form-group">
                                            <input asp-for="Languages[i].Id" type="hidden" />
                                            <input asp-for="Languages[i].Name" type="hidden" />
                                            <input asp-for="Languages[i].IsActive" type="hidden" />
                                            <input asp-for="Languages[i].IsDefault" type="hidden" />

                                            <div class="form-group">
                                                <label>Product name</label>
                                                <input asp-for="Languages[i].Data.Name" type="text" class="form-control" />
                                                <span asp-validation-for="Languages[i].Data.Name" class="text-danger"></span>
                                            </div>

                                            <div class="form-group">
                                                <label>Description</label>
                                                <textarea id="description-text-area" class="form-control" asp-for="Languages[i].Data.Description" style="height: 150px"></textarea>
                                                <span asp-validation-for="Languages[i].Data.Description" class="text-danger"></span>
                                            </div>
                                        </div>
                                    </div>
                                }
                            </div>
                        </div>
                        <div class="tab-pane" id="tab-data">
                            <div class="form-group p-3">
                                <div class="form-group">
                                    <label>Product images</label>
                                    <div class="text-left">
                                        <div action="/panel/catalog/products/addImages" class="dropzone" id="my-awesome-dropzone"></div>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label>Sub category</label>
                                    <select style="width: 100%;" class="form-control" asp-for="SubCategoryId" asp-items="@Model.ProductSubCategories"></select>
                                </div>
                                <div class="form-group">
                                    <label>Price</label>
                                    <input asp-for="Price" type="text" class="form-control" />
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer justify-content-between">
                        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                        <button id="add-btn" type="submit" class="btn btn-primary">Add</button>
                    </div>
                </div>
            </form>
        </div>
    </div>
</div>
<div class="modal fade" id="modal-confirm-delete">
    <div class="modal-dialog">
        <div class="modal-content active">
            <div class="modal-header">
                <h4 class="modal-title">Confirm</h4>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-footer justify-content-between">
                <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                <form asp-action="Delete" asp-antiforgery="true">
                    <input data-selected-productId type="hidden" asp-for="Id" />
                    <button type="submit" class="btn btn-primary">Delete</button>
                </form>
            </div>
        </div>
    </div>
</div>

@section Scripts
{
    <script src="~/lib/dropzone/dropzone.min.js"></script>
    <script src="~/lib/datatables/js/jquery.dataTables.min.js"></script>
    <script src="~/lib/toastr.js/toastr.min.js"></script>
    <script type="text/javascript">
        $('#products-table').DataTable({
            "searching": false,
            "responsive": true,
            "info": false,
            "lengthChange": false,
            "paging": false,
        });

        $('.btn-delete').click(function () {
            $('[data-selected-productId]').val($(this).data('id'));
        });

        $('#add-btn').click(function () {
            Dropzone.instances[0].processQueue();
        });

        let allowedExtentions = ['.png', '.jpg', '.jpeg'];
        Dropzone.options.myAwesomeDropzone = {
            paramName: 'files',
            acceptedFiles: 'image/*',
            addRemoveLinks: true,
            accept: function (file, done) {
                if (!file?.name || (!allowedExtentions.some(e => file.name.endsWith(e)))) {
                    done('Only files in jpg/png can be uploaded.');
                } else {
                    done();
                }
            },
            autoProcessQueue: false,
            previewsContainer: '.dropzone',
            dictDefaultMessage: 'Drop images here',
            uploadMultiple: true,
            parallelUploads: 10,
        };
    </script>
}